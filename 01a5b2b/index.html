<html>
<head>
<style>
@font-face {
   font-family: Lato;
   src: url(Lato-Light.ttf);
}

/*.mySlides {display:none;}*/
    
/* video background */
#background-video {
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  z-index: -1;
  filter: brightness(40%);
}

html {
  height: 100vh;
}

body {
  height: 500vh;
  background: #000;
  font-family: Arial, Helvetica, sans-serif;
  margin: 0;
  padding: 0;
}

canvas {
  width: 100%;
  border: 1px dashed orangered;
  position: fixed;
  left: 0;
  top: 0;
  z-index: 0;
  /*transform: translate(-50%, -50%);
  max-width: 100vw;
  max-height: 100vh;*/
}

/*
.hero-image {
  background-color: #cccccc;
  height: 100%;
  background-position: center;
  background-repeat: no-repeat;
  background-size: cover;
  position: relative;
}

.hero-text {
  text-align: center;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
}*/

@media (max-width: 750px) {
    #background-video { display: none; }
    body {
      background: url("0511.jpg") no-repeat;
      background-size: cover;
    }
}

/*main {
  background-color: lightblue;
  font-size: 2rem;
  margin-top: 50vh;
  padding: 10px;
  position: relative;
}*/

.container {
        width: 100%;
        margin: 0 auto;
        padding: 20px;
        border: 0;
        display: flex;
        flex-flow: column;
   text-align: right
position: absolute;
background-color: transparent;
 font-family: 'Lato', sans-serif;
justify-content: flex-end;
bottom: 0;
  /*flex-wrap: wrap-reverse;*/
      }

.container h1{
white-space: nowrap;
color: white; 
font-size: 70px;
z-index: 1001;
margin: 0 50px
}
.container h2{
white-space: nowrap;
color: white; 
font-size: 50px;
z-index: 1001;
margin: 0 50px
}
  </style>
  </head>
<body>
 
<video id="background-video" autoplay loop muted poster="0511.jpg">
  <source src="front-entry-web.mp4" type="video/mp4">
</video>

<div class="container" id="adsTxt"><h1>Canyon Crest Drive</h1>
<h2>City of San Ramon</h2></div>

<canvas id="hero-lightpass" />

<!--<main>
<div class="w3-content w3-display-container">
  <div class="mySlides hero-image"></div>
</div>
  </main>-->
<script>
   
var backgrounds = new Array(
    '0511.jpg'
  , '0472.jpg'
  , '0509.jpg'
  , '0510.jpg'
);

const html = document.documentElement;
const canvas = document.getElementById("hero-lightpass");
//canvas.style.height = html.innerHeight;
//canvas.style.top = html.innerHeight + 1;


const cxt = canvas.getContext("2d");

const frameCount = 4;
const currentFrame = index => (
  `${backgrounds[index]}`
)

const preloadImages = () => {
  for (let i = 1; i < frameCount; i++) {
    const img = new Image();
    img.src = currentFrame(i);
  }
};

const img = new Image()
//img.width = window.innerWidth;  
//img.src = `https://portal.okaneda.com/01a5b2b/${currentFrame(1)}`;

img.onload=function(){
  //context.canvas.width=window.innerWidth;
  //context.canvas.height=img.height;
  console.log(`image width: ${window.innerWidth} image height: ${img.height*img.width/window.innerWidth}`)
  cxt.drawImage(img, 0, 0, window.innerWidth,img.height*img.width/window.innerWidth);  
}

const updateImage = index => {
  img.src = currentFrame(index);
  cxt.drawImage(img, 0, 0, window.innerWidth,img.height*img.width/window.innerWidth);
}

function elementInViewport2(el) {
  var top = el.offsetTop;
  var left = el.offsetLeft;
  var width = el.offsetWidth;
  var height = el.offsetHeight;

  while(el.offsetParent) {
    el = el.offsetParent;
    top += el.offsetTop;
    left += el.offsetLeft;
  }

  return (
    top < (window.pageYOffset + window.innerHeight) &&
    left < (window.pageXOffset + window.innerWidth) &&
    (top + height) > window.pageYOffset &&
    (left + width) > window.pageXOffset
  );
}

//cxt.fillStyle = "green";
//cxt.fillRect(20, 10, 150, 100);
var renderImg = false;

var adsTxt = document.getElementById("adsTxt");

window.addEventListener('scroll', () => {  
  const scrollTop = html.scrollTop;
  const maxScrollTop = html.scrollHeight - window.innerHeight;
  const scrollFraction = scrollTop / maxScrollTop;
  const frameIndex = Math.min(
    frameCount - 1,
    Math.ceil(scrollFraction * frameCount)
  );
  
  
  if (elementInViewport2(adsTxt)) {
     console.log(`ads text is viewable`);
if (renderImg) {
renderImg=false;
cxt.clearRect(0, 0, canvas.width, canvas.height);
}
  } else {
console.log(`ads text is not viewable`);
if (!renderImg) {
    
renderImg=true;
img.src = `${currentFrame(1)}`;
}

}
  //requestAnimationFrame(() => updateImage(frameIndex + 1))
});

//preloadImages();


</script>
</body>
</html>
